<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atracciones Turísticas - Pichincha</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<header class="bg-blue-600 text-white p-4 flex justify-between items-center">
  <h1 class="text-xl font-bold">Atracciones Turísticas</h1>
  <div class="flex gap-3 items-center">
    <span id="usuarioNombre" class="hidden"></span>
    <a href="reservas.html" id="linkReservas" class="bg-green-500 px-3 py-1 rounded hidden">Mis Reservas</a>
    <a href="admin.html" id="linkAdmin" class="bg-purple-600 px-3 py-1 rounded hidden">Panel Admin</a>
    <button id="logoutBtn" class="bg-red-500 px-3 py-1 rounded hidden">Cerrar sesión</button>
    <a href="login.html" id="loginBtn" class="bg-white text-blue-600 px-3 py-1 rounded">Login</a>
  </div>
</header>

<main class="p-6">
  <h2 class="text-2xl font-bold mb-4">Catálogo de Atracciones</h2>

  <div id="atracciones" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
</main>

<script type="module">
  import { apiFetch } from './js/api.js';
  import { getUser, logout, isAuthenticated, isAdmin } from './js/auth.js';

  // Configurar interfaz según autenticación
  const user = getUser();
  
  if (isAuthenticated()) {
    document.getElementById('loginBtn').classList.add('hidden');
    document.getElementById('usuarioNombre').classList.remove('hidden');
    if (user) {
      document.getElementById('usuarioNombre').textContent = `Hola, ${user.name}`;
    }
    document.getElementById('logoutBtn').classList.remove('hidden');
    document.getElementById('linkReservas').classList.remove('hidden');
    
    // Mostrar panel admin solo si es admin
    if (isAdmin()) {
      document.getElementById('linkAdmin').classList.remove('hidden');
    }

    document.getElementById('logoutBtn').addEventListener('click', logout);
  }

  const grid = document.getElementById('atracciones');

  async function cargarAtracciones() {
    try {
      const atracciones = await apiFetch('/atracciones');

      grid.innerHTML = atracciones.map(a => `
        <div class="bg-white rounded shadow overflow-hidden hover:shadow-lg transition">
          ${a.imagen_url ? `<img src="${a.imagen_url}" class="h-48 w-full object-cover">` : ''}
          <div class="p-4">
            <h2 class="font-bold text-lg">${a.nombre}</h2>
            <p class="text-sm text-gray-600 mb-2">${a.ubicacion}</p>
            <p class="text-sm text-gray-700 mb-3 line-clamp-2">${a.descripcion}</p>
            <p class="text-blue-600 font-semibold mb-3">$${a.precio || 'Consultar'}</p>
            <a href="detalle.html?id=${a.id}"
               class="inline-block w-full text-center bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
               Ver detalle
            </a>
          </div>
        </div>
      `).join('');

    } catch (e) {
      grid.innerHTML = '<p class="text-red-600 col-span-full text-center">Error cargando atracciones</p>';
    }
  }

  cargarAtracciones();
</script>
</body>
</html>
